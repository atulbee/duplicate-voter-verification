{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/Kamalakar/Duplicate%20VoterVerification/duplicate-voter-verification/src/lib/hmac.ts"],"sourcesContent":["import CryptoJS from 'crypto-js';\r\n\r\nexport function unixTimestampSeconds(): string {\r\n  return Math.floor(Date.now() / 1000).toString();\r\n}\r\n\r\nexport function signRequest(\r\n  method: string,\r\n  pathWithQuery: string,\r\n  body: string,\r\n  timestamp: string,\r\n  apiKey: string,\r\n  secretKey: string\r\n): string {\r\n  const stringToSign = method.toUpperCase() + pathWithQuery + body + timestamp + apiKey;\r\n  const signature = CryptoJS.HmacSHA256(stringToSign, secretKey).toString(CryptoJS.enc.Base64);\r\n  return signature;\r\n}\r\n\r\nexport function buildAuthHeaders(\r\n  method: string,\r\n  pathWithQuery: string,\r\n  body: string\r\n): HeadersInit {\r\n  const apiKey = process.env.API_KEY ?? '';\r\n  const secretKey = process.env.SECRET_KEY ?? '';\r\n  const timestamp = unixTimestampSeconds();\r\n  const signature = signRequest(method, pathWithQuery, body, timestamp, apiKey, secretKey);\r\n  return {\r\n    'X-API-Key': apiKey,\r\n    'X-Timestamp': timestamp,\r\n    'X-Signature': signature,\r\n  };\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;;AAEO,SAAS;IACd,OAAO,KAAK,KAAK,CAAC,KAAK,GAAG,KAAK,MAAM,QAAQ;AAC/C;AAEO,SAAS,YACd,MAAc,EACd,aAAqB,EACrB,IAAY,EACZ,SAAiB,EACjB,MAAc,EACd,SAAiB;IAEjB,MAAM,eAAe,OAAO,WAAW,KAAK,gBAAgB,OAAO,YAAY;IAC/E,MAAM,YAAY,kJAAQ,CAAC,UAAU,CAAC,cAAc,WAAW,QAAQ,CAAC,kJAAQ,CAAC,GAAG,CAAC,MAAM;IAC3F,OAAO;AACT;AAEO,SAAS,iBACd,MAAc,EACd,aAAqB,EACrB,IAAY;IAEZ,MAAM,SAAS,QAAQ,GAAG,CAAC,OAAO,IAAI;IACtC,MAAM,YAAY,QAAQ,GAAG,CAAC,UAAU,IAAI;IAC5C,MAAM,YAAY;IAClB,MAAM,YAAY,YAAY,QAAQ,eAAe,MAAM,WAAW,QAAQ;IAC9E,OAAO;QACL,aAAa;QACb,eAAe;QACf,eAAe;IACjB;AACF"}},
    {"offset": {"line": 85, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/Kamalakar/Duplicate%20VoterVerification/duplicate-voter-verification/src/lib/api/server.ts"],"sourcesContent":["import { buildAuthHeaders } from '@/lib/hmac';\r\n\r\nfunction getBaseUrl() {\r\n  return process.env.BASE_URL || '';\r\n}\r\n\r\nasync function request<T>(\r\n  method: 'GET' | 'POST',\r\n  path: string,\r\n  body?: unknown\r\n): Promise<T> {\r\n  const url = new URL(path, getBaseUrl());\r\n  const pathWithQuery = url.pathname + (url.search || '');\r\n  const bodyStr = body ? JSON.stringify(body) : '';\r\n  const headers: HeadersInit = {\r\n    'Content-Type': 'application/json',\r\n    ...buildAuthHeaders(method, pathWithQuery, bodyStr),\r\n  };\r\n  console.log(`[API Server] ${method} ${url.toString()}`);\r\n  \r\n  const res = await fetch(url.toString(), {\r\n    method,\r\n    headers,\r\n    body: bodyStr || undefined,\r\n    cache: 'no-store',\r\n    next: { revalidate: 0 },\r\n  } as RequestInit);\r\n  \r\n  console.log(`[API Server] Response status: ${res.status}`);\r\n  \r\n  if (!res.ok) {\r\n    const text = await res.text();\r\n    console.error(`[API Server] Error response:`, text);\r\n    throw new Error(`API ${method} ${path} failed: ${res.status} ${text}`);\r\n  }\r\n  \r\n  const json = await res.json();\r\n  console.log('[API Server] Response JSON:', json);\r\n  \r\n  // Handle .NET ApiResponse wrapper structure\r\n  if (json && typeof json === 'object') {\r\n    // Check if it's wrapped in ApiResponse with Success/Data pattern\r\n    if ('success' in json || 'Success' in json) {\r\n      const success = json.success ?? json.Success;\r\n      console.log('[API Server] .NET ApiResponse detected, Success:', success);\r\n      \r\n      if (!success) {\r\n        const message = json.message ?? json.Message ?? 'API request failed';\r\n        const errorCode = json.errorCode ?? json.ErrorCode ?? 'UNKNOWN_ERROR';\r\n        console.error('[API Server] .NET API returned failure:', { message, errorCode });\r\n        throw new Error(`${message} (${errorCode})`);\r\n      }\r\n      \r\n      // Extract the actual data from Data property\r\n      const data = json.data ?? json.Data;\r\n      console.log('[API Server] Extracted data from .NET ApiResponse:', data);\r\n      return data as T;\r\n    }\r\n  }\r\n  \r\n  return json as T;\r\n}\r\n\r\nexport const apiServer = {\r\n  findDuplicates: (payload: { firstName: string; middleName?: string; lastName: string }) =>\r\n    request<any>('POST', '/api/voters/find-duplicates', payload),\r\n  verificationStatus: () => request<any>('GET', '/api/voters/verification-status'),\r\n  duplicateGroups: (duplicationId?: number) =>\r\n    request<any>('GET', duplicationId ? `/api/voters/duplicate-groups?duplicationId=${duplicationId}` : '/api/voters/duplicate-groups'),\r\n  voterBySrNo: (srNo: number) => request<any>('GET', `/api/voters/${srNo}`),\r\n  unverifiedCount: () => request<any>('GET', '/api/voters/unverified-count'),\r\n  markDuplicates: (payload: { srNoArray: number[]; isDuplicate: boolean; remarks?: string }) =>\r\n    request<any>('POST', '/api/voters/mark-duplicates', payload),\r\n  resetVerification: () => request<any>('POST', '/api/voters/reset-verification'),\r\n  voterReport: (payload: any) => request<any>('POST', '/api/voters/report', payload),\r\n};\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,SAAS;IACP,OAAO,QAAQ,GAAG,CAAC,QAAQ,IAAI;AACjC;AAEA,eAAe,QACb,MAAsB,EACtB,IAAY,EACZ,IAAc;IAEd,MAAM,MAAM,IAAI,IAAI,MAAM;IAC1B,MAAM,gBAAgB,IAAI,QAAQ,GAAG,CAAC,IAAI,MAAM,IAAI,EAAE;IACtD,MAAM,UAAU,OAAO,KAAK,SAAS,CAAC,QAAQ;IAC9C,MAAM,UAAuB;QAC3B,gBAAgB;QAChB,GAAG,IAAA,wIAAgB,EAAC,QAAQ,eAAe,QAAQ;IACrD;IACA,QAAQ,GAAG,CAAC,CAAC,aAAa,EAAE,OAAO,CAAC,EAAE,IAAI,QAAQ,IAAI;IAEtD,MAAM,MAAM,MAAM,MAAM,IAAI,QAAQ,IAAI;QACtC;QACA;QACA,MAAM,WAAW;QACjB,OAAO;QACP,MAAM;YAAE,YAAY;QAAE;IACxB;IAEA,QAAQ,GAAG,CAAC,CAAC,8BAA8B,EAAE,IAAI,MAAM,EAAE;IAEzD,IAAI,CAAC,IAAI,EAAE,EAAE;QACX,MAAM,OAAO,MAAM,IAAI,IAAI;QAC3B,QAAQ,KAAK,CAAC,CAAC,4BAA4B,CAAC,EAAE;QAC9C,MAAM,IAAI,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,EAAE,KAAK,SAAS,EAAE,IAAI,MAAM,CAAC,CAAC,EAAE,MAAM;IACvE;IAEA,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,QAAQ,GAAG,CAAC,+BAA+B;IAE3C,4CAA4C;IAC5C,IAAI,QAAQ,OAAO,SAAS,UAAU;QACpC,iEAAiE;QACjE,IAAI,aAAa,QAAQ,aAAa,MAAM;YAC1C,MAAM,UAAU,KAAK,OAAO,IAAI,KAAK,OAAO;YAC5C,QAAQ,GAAG,CAAC,oDAAoD;YAEhE,IAAI,CAAC,SAAS;gBACZ,MAAM,UAAU,KAAK,OAAO,IAAI,KAAK,OAAO,IAAI;gBAChD,MAAM,YAAY,KAAK,SAAS,IAAI,KAAK,SAAS,IAAI;gBACtD,QAAQ,KAAK,CAAC,2CAA2C;oBAAE;oBAAS;gBAAU;gBAC9E,MAAM,IAAI,MAAM,GAAG,QAAQ,EAAE,EAAE,UAAU,CAAC,CAAC;YAC7C;YAEA,6CAA6C;YAC7C,MAAM,OAAO,KAAK,IAAI,IAAI,KAAK,IAAI;YACnC,QAAQ,GAAG,CAAC,sDAAsD;YAClE,OAAO;QACT;IACF;IAEA,OAAO;AACT;AAEO,MAAM,YAAY;IACvB,gBAAgB,CAAC,UACf,QAAa,QAAQ,+BAA+B;IACtD,oBAAoB,IAAM,QAAa,OAAO;IAC9C,iBAAiB,CAAC,gBAChB,QAAa,OAAO,gBAAgB,CAAC,2CAA2C,EAAE,eAAe,GAAG;IACtG,aAAa,CAAC,OAAiB,QAAa,OAAO,CAAC,YAAY,EAAE,MAAM;IACxE,iBAAiB,IAAM,QAAa,OAAO;IAC3C,gBAAgB,CAAC,UACf,QAAa,QAAQ,+BAA+B;IACtD,mBAAmB,IAAM,QAAa,QAAQ;IAC9C,aAAa,CAAC,UAAiB,QAAa,QAAQ,sBAAsB;AAC5E"}},
    {"offset": {"line": 157, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ACER/Documents/Kamalakar/Duplicate%20VoterVerification/duplicate-voter-verification/src/app/api/voters/find-duplicates/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server';\r\nimport { apiServer } from '@/lib/api/server';\r\n\r\ntype AnyRecord = Record<string, any>;\r\n\r\nfunction toNumber(n: any): number | undefined {\r\n  const num = Number(n);\r\n  return Number.isFinite(num) ? num : undefined;\r\n}\r\n\r\nfunction extractSrNo(r: AnyRecord): number | undefined {\r\n  return (\r\n    toNumber(r.srNo) ??\r\n    toNumber(r.SrNo) ??\r\n    toNumber(r.SRNO) ??\r\n    toNumber(r.sr_no) ??\r\n    toNumber(r.SR_NO) ??\r\n    undefined\r\n  );\r\n}\r\n\r\nfunction isVerified(r: AnyRecord): boolean {\r\n  const v = r.verified ?? r.Verified ?? r.isVerified ?? r.IsVerified ?? r.verificationStatus ?? r.VerificationStatus ?? r.status ?? r.Status;\r\n  if (typeof v === 'boolean') return v;\r\n  if (typeof v === 'string') {\r\n    const lower = v.toLowerCase();\r\n    return ['verified', 'true', 'yes', '1'].includes(lower);\r\n  }\r\n  if (typeof v === 'number') return v === 1;\r\n  return false;\r\n}\r\n\r\nfunction normalizeRecords(payload: any): AnyRecord[] {\r\n  console.log('[find-duplicates route] Normalizing records from payload:', payload);\r\n  \r\n  // Handle array directly\r\n  if (Array.isArray(payload)) {\r\n    console.log('[find-duplicates route] Payload is array, length:', payload.length);\r\n    return payload as AnyRecord[];\r\n  }\r\n  \r\n  // Handle nested data structures (both camelCase and PascalCase)\r\n  if (Array.isArray(payload?.records)) {\r\n    console.log('[find-duplicates route] Found records (camelCase), length:', payload.records.length);\r\n    return payload.records as AnyRecord[];\r\n  }\r\n  if (Array.isArray(payload?.Records)) {\r\n    console.log('[find-duplicates route] Found Records (PascalCase), length:', payload.Records.length);\r\n    return payload.Records as AnyRecord[];\r\n  }\r\n  if (Array.isArray(payload?.data)) {\r\n    console.log('[find-duplicates route] Found data (camelCase), length:', payload.data.length);\r\n    return payload.data as AnyRecord[];\r\n  }\r\n  if (Array.isArray(payload?.Data)) {\r\n    console.log('[find-duplicates route] Found Data (PascalCase), length:', payload.Data.length);\r\n    return payload.Data as AnyRecord[];\r\n  }\r\n  if (Array.isArray(payload?.result)) {\r\n    console.log('[find-duplicates route] Found result (camelCase), length:', payload.result.length);\r\n    return payload.result as AnyRecord[];\r\n  }\r\n  if (Array.isArray(payload?.Result)) {\r\n    console.log('[find-duplicates route] Found Result (PascalCase), length:', payload.Result.length);\r\n    return payload.Result as AnyRecord[];\r\n  }\r\n  \r\n  console.warn('[find-duplicates route] No array found in payload, returning empty array');\r\n  return [];\r\n}\r\n\r\nexport async function POST(req: NextRequest) {\r\n  console.log('[find-duplicates route] POST request received');\r\n  \r\n  const body = await req.json();\r\n  console.log('[find-duplicates route] Request body:', body);\r\n  \r\n  const raw = await apiServer.findDuplicates(body);\r\n  console.log('[find-duplicates route] Raw API response:', raw);\r\n  \r\n  const recordsRaw = normalizeRecords(raw);\r\n  console.log('[find-duplicates route] Normalized records count:', recordsRaw.length);\r\n\r\n  const records = recordsRaw.map((item: any) => {\r\n    // Ensure object shape\r\n    const obj: any = item && typeof item === 'object' ? { ...item } : { value: item };\r\n    const id = extractSrNo(obj);\r\n    if (id !== undefined) obj.srNo = obj.srNo ?? id;\r\n    obj.isVerified = isVerified(obj);\r\n    return obj;\r\n  });\r\n  \r\n  console.log('[find-duplicates route] Processed records count:', records.length);\r\n\r\n  const verifiedSrNos: number[] = [];\r\n  for (const r of records) {\r\n    const id = extractSrNo(r);\r\n    if (id !== undefined && (r.isVerified === true || isVerified(r))) verifiedSrNos.push(id);\r\n  }\r\n  \r\n  console.log('[find-duplicates route] Verified SrNos:', verifiedSrNos);\r\n  \r\n  const response = { records, verifiedSrNos };\r\n  console.log('[find-duplicates route] Returning response with', records.length, 'records and', verifiedSrNos.length, 'verified');\r\n  \r\n  return NextResponse.json(response);\r\n}\r\n"],"names":[],"mappings":"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"}}]
}